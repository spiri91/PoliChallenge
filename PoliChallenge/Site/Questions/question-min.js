"use strict";!function(e,n,t,s,r,a){let i=[],u=[],l=null,o=null,c=!1,f={places:$("#listOfPlaces"),questions:$("#listOfQuestions"),delete:$("#delete"),token:$("#token"),statement:$("#statement"),answer1:$("#answer1"),answer2:$("#answer2"),answer3:$("#answer3"),correctAnswer:$("#correctAnswer"),submit:$("#submit"),update:$("#update")};function w(){!function(){if(c)return;f.delete.click(T),f.submit.click(I),f.update.click(q),f.places.change(O),f.questions.change(m),c=!0}(),i=s.get(s.names.places),f.places.empty().append('<option value="" selected>'+a.questions.QUESTIONS_SELECT_PLACE+"</option>"),$.each(i,function(){f.places.append(new Option(this.name,this.key))}),p(),g(),E()}function p(){t.disableElements([f.delete,f.update])}function m(){let e=f.questions.find(":selected");if(0===e.length)return;let n=t.findInArray(u,e[0].value);var s;n?(o=n,t.enableElements([f.delete,f.update]),s=n,t.setValueOf(f.statement,s.statement),t.setValueOf(f.answer1,s.answer1),t.setValueOf(f.answer2,s.answer2),t.setValueOf(f.answer3,s.answer3),t.setValueOf(f.correctAnswer,s.correctAnswer),E()):(o=null,p(),h(),d())}function d(){t.setValueOf(f.statement,""),t.setValueOf(f.answer1,""),t.setValueOf(f.answer2,""),t.setValueOf(f.answer3,""),t.setValueOf(f.correctAnswer,"")}function h(){t.enableElements([f.submit])}function E(){t.disableElements([f.submit])}function O(){let e=f.places.find(":selected");if(0===e.length)return;let n=t.findInArray(i,e[0].value);l=n,n?(!function(e){let n=s.get(s.names.questions).filter(n=>n.for===e.key);u=n,f.questions.empty().append('<option value= "" selected>'+a.questions.QUESTIONS_SELECT_QUESTION_FOR_EDIT+"</option>"),$.each(n,function(){f.questions.append(new Option(this.statement,this.key))})}(n),t.enableElements([f.questions]),h(),p()):S()}function S(){g(),f.questions.empty(),d(),E(),p()}function g(){t.disableElements([f.questions])}function T(){let n=t.valueOf(f.token);n&&""!=n?t.confirm(a.questions.DELETE_QUESTION,()=>t.showSpinner().then(()=>e.delete(e.entities.questions,o.key,n)).then(()=>t.success(a.messages.DELETED_ITEM),y).then(k).then(A).then(w).then(t.hideSpinner)):t.warning(a.messages.MISSING_TOKEN)}function k(){return r.fillAll(e,s)}function A(){t.setSelectedIndexOfSelectElement(f.places,0),S()}function I(){let s=t.valueOf(f.token);if(!s||""==s)return void t.warning(a.messages.MISSING_TOKEN);let r=n.generate(),i=l.key,u=v(),o=e.createQuestion({key:r,belongsTo:i,statement:u.statement,answer1:u.answer1,answer2:u.answer2,answer3:u.answer3,correctAnswer:u.correctAnswer});return t.showSpinner().then(()=>e.post(e.entities.questions,o,s)).then(()=>t.success(a.messages.CREATED_ITEM),y).then(d).then(t.hideSpinner)}function q(){let n=t.valueOf(f.token);if(!n||""==n)return void t.warning(a.messages.MISSING_TOKEN);let s=o.key,r=l.key,i=v(),u=e.createQuestion({key:s,belongsTo:r,statement:i.statement,answer1:i.answer1,answer2:i.answer2,answer3:i.answer3,correctAnswer:i.correctAnswer});return t.showSpinner().then(()=>e.put(e.entities.questions,u,n)).then(()=>t.success(a.messages.UPDATED_ITEM),y).then(k).then(A).then(w).then(t.hideSpinner)}function v(){return{statement:t.valueOf(f.statement),answer1:t.valueOf(f.answer1),answer2:t.valueOf(f.answer2),answer3:t.valueOf(f.answer3),correctAnswer:t.valueOf(f.correctAnswer)}}function y(e){if(!t.error(e))throw t.hideSpinner(),console.log(e),new Error("Break promise chain")}w()}(repo,guidGenerator,_,storage,entities,constants);